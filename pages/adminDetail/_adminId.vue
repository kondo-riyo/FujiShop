<template>
   <div class="p-1">
    <div 
    @click="back_onStep"
    class="
    flex
    group
    ">
      <div class="
      group-hover:bg-base_red group-hover:bg-opacity-30
      p-4
      rounded-full
      ">
        <img src="~assets/img/yajirusi_icon.webp" class="transform rotate-90 w-5">
      </div>
      <div class="text-base_red font-bold m-3 mx-1">
        ユーザー情報一覧に戻る
      </div>
    </div>
    <div class="grid justify-items-center">
    <div>
      <!-- <select
       @change="displaySelect"
       v-model="selectStatus"
       name="表示status"
       class="
        bg-base_red hover:bg-opacity-70
        text-white text-center
        rounded-lg
        p-3
        m-1
       "
       >
               <option value="0"> ALL </option>
               <option value="1">未入金(代引き)</option>
               <option value="2">入金済(クレジット)</option>
               <option value="3">発送済</option>
               <option value="4">配達済</option>
               <option value="9">キャンセル</option>               
      </select>
    </div> -->
    <!-- <div 
     v-if="!this.newlogItems.length"
     class="text-base_red font-bold border-b-2 border-base_gray text-lg pt-6"
    >
      {{this.statusName}}商品はありません
    </div> -->
    <div
      class="grid lg:m-5 m-1 justify-items-center"
    >
      <div class="bg-white bg-opacity-60 rounded-xl w-10/12">
        <div
          class="
            bg-base_red
            text-base_cream
            font-bold
            text-xl
            rounded
            border-solid border-2
            border-base_red
            flex
            text-center
          "
        >
          <div class="p-1 lg:w-3/5 lg:text-center text-2xl">商品情報</div>
          <div class="p-1 lg:w-1/5 text-2xl hidden lg:inline-block">
            配達情報
          </div>
          <div class="p-1 lg:w-1/5 text-2xl hidden lg:inline-block">
          </div>
        </div>
        <div
          v-for="logItem in getLogItems"
          :key="logItem.orderId"
          class="
            lg:flex
            border-solid
            rounded
            border-b-2 border-r-2 border-l-2
            border-base_red
          "
        > 
        <!--   1. アイテム情報 -->
          <div 
           class="p-2 lg:w-3/5" >
            <div
              v-for="item in logItem.itemInfo"
              :key="item.specialId"
              class="m-1 p-1"
            >
              <div class="flex items-center justify-center">
                <div class="lg:w-1/4 w-2/5">
                  <img class="rounded shadow-xl" :src="item.itemImg" />
                </div>
                <div class="flex flex-col ml-2 w-96 w-2/4">
                  <div class="p-1 flex">
                    <div class="w-3/4">
                      <span class="font-bold lg:text-xl">{{
                        item.itemName
                      }}</span
                      >×{{ item.itemNum }}
                    </div>
                    <div class="w-1/4 lg:text-base text-xs">
                      {{ item.itemPrice * item.itemNum }}円
                    </div>
                  </div>
                  <div
                    class="p-1 lg:text-base text-xs flex"
                    v-for="(topping, index) in item.toppings"
                    :key="index"
                  >
                    <div class="w-3/4">+{{ topping.name }}</div>
                    <div class="w-1/4 lg:text-base text-xs">
                      {{ topping.price }}円
                    </div>
                  </div>
                  <div class="p-1 pt-5 flex">
                    <div class="w-3/4 lg:text-base text-xs">合計</div>
                    <div class="w-1/4 lg:text-base text-xs">
                      {{
                        item.itemPrice * item.itemNum + item.allToppingPrice
                      }}円
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="
                flex
                items-center
                border-solid border-t-2
                border-base_gray
                border-opacity-20
                mt-3
                pt-3
                pb-3
              "
            >
              <div class="w-16"></div>
              <div class="lg:text-2xl text-xl lg:pr-0 pr-2 lg:w-2/6">
                合計金額
              </div>
              <div class="lg:text-3xl text-xl font-bold w-1/4">
                {{ logItem.orderInfo.allPrice }}円
              </div>
            </div>
         </div>
        <!-- 1. お客様情報 -->
         <div
            class="
              w-80
              bg-base_gray
              bg-opacity-20
              text-lg
              flex flex-col
              justify-center
              items-center
              pl-2
              pb-3
              lg:w-1/5
              w-full
            "
          >
            <div>
              <div
                class="
                  lg:hidden
                  text-xl
                  border-solid
                  border-base_red
                  border-b-2 border-opacity-20
                  pt-2
                  pb-1
                  mb-2
                "
              >
                配達情報
              </div>
              <div>注文者 : {{ logItem.orderInfo.name}} 様</div>
              <div>配送先 : {{ logItem.orderInfo.address }}</div>
              <div>
                配送日時 : {{ logItem.orderInfo.deliveryDate }}
                {{ logItem.orderInfo.deliveryTime }}時
              </div>
            </div>
          </div>
          <!-- 1. 配達情報 -->
          <div
            class="
              w-80
              bg-base_gray bg-opacity-20 lg:bg-transparent
              border-base_red border-opacity-20 border-dashed border-t-2 lg:border-0
              text-lg
              flex flex-col
              justify-center
              items-center
              pl-2
              py-3
              lg:w-1/5
              w-full
            "
          >
            <div>
              <select
               v-model="logItem.status"
               @change="statusChange(logItem.orderId, logItem.status, params)"
               name="配達status"
               class="
                bg-base_red
                text-white text-center
                rounded
                "
              >
               <option value="1">未入金(代引き)</option>
               <option value="2">入金済(クレジット)</option>
               <option value="3">発送済</option>
               <option value="4">配達済</option>
               <option value="9">キャンセル</option>               
              </select>  
            </div>
          </div>
        </div>
        </div>

          <!-- 1. 終わり -->

      </div>
    </div>
    </div>
    <div 
    @click="back_onStep"
    class="
    flex
    group
    ">
      <div class="
      group-hover:bg-base_red group-hover:bg-opacity-30
      p-4
      rounded-full
      ">
        <img src="~assets/img/yajirusi_icon.webp" class="transform rotate-90 w-5">
      </div>
      <div class="text-base_red font-bold m-3 mx-1">
        ユーザー情報一覧に戻る
      </div>
    </div>

   </div>
</template>
<script lang="ts">
import Vue from 'vue';
import selectA from '../../components/atoms/selectA.vue';
import { UserStore, AdminStore } from '../../store';

type DataType = {
  selectStatus: number;
  statusName: string;
  newlogItems: any;
  params: string;
};


export default Vue.extend({
  components: { selectA },
  head() {
    return {
      title: '注文履歴',
    };
  },
  data(): DataType {
    return {
      selectStatus: 0,
      statusName: '',
      newlogItems: [],
      params: '',
    };
  },
  computed: {
    getLogItems(){
      //@ts-ignore
      return AdminStore.getstoreLogItems
    },
    totalItemPrice():number {
      let totalPrice: number = 0;
      //@ts-ignore
      this.logItems.forEach((item:any) => {
        item.itemInfo!.forEach((price:any) => {
          totalPrice = totalPrice + price.totalPrice!;
        });
      });
      return totalPrice;
    },
  },
  async fetch(): Promise<void> {
  // async asyncData(context) {
    if (!UserStore.userInfo) {
      console.log('ログインしていません');
    } else {
      if (!UserStore.userInfo.uid) return;
      // const id = context.params 
      this.params = String(this.$route.params.adminId);
      // await this.params
      console.log(this.params);
      await AdminStore.fetchLogItemsAct(this.params);
    }
  },
  // created(){
  //   this.newlogItems = this.getLogItems
  //   console.log(this.getLogItems)
  // },
  
  methods:{
      // statusを変えるためのStore呼び出し
      statusChange(id:string, status:number, uid:string):void{
          let idStatus= {id:id, status:status, uid:uid}
          AdminStore.updateStatusAct(idStatus)
      },
      back_onStep() {
        this.$router.push('/admin')
      },
      // displaySelect(): Array<void>|undefined{
      //   console.log(this.selectStatus)
      //   if(this.selectStatus == 0){
      //     this.statusName = '注文済みの'
      //     return this.newlogItems = AdminStore.getstoreLogItems
      //   } else {
      //     //@ts-ignore
      //     if(this.selectStatus == 1){
      //       this.statusName = '未入金(代引き)の'
      //     }else if(this.selectStatus == 2){
      //       this.statusName = '入金済(クレジット)の'
      //     }else if(this.selectStatus == 3){
      //       this.statusName = '発送済の'
      //     }else if(this.selectStatus == 4){
      //       this.statusName = '配達済の'
      //     }else if(this.selectStatus == 9){
      //       this.statusName = '注文をキャンセルした'
      //     }
      //     //@ts-ignore
      //     this.newlogItems = this.getLogItems.filter(e => e.status == this.selectStatus)
      //     // return this.newlogItems
      //   }
      // }
  }
});
</script>
